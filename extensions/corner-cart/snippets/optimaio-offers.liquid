<div id="optimaio-offers-section" class="optimaio-offers-section">
  <h3 class="optimaio-offers-title">Exclusive Offers üéâ</h3>

  <div id="optimaio-offers-list" class="optimaio-offers-grid">
    <div class="optimaio-offer-card">Loading offers...</div>
  </div>
</div>

<script>
(function(){

  async function loadOffers() {
    const wrapper = document.getElementById("optimaio-offers-list");
    if (!wrapper) return;

    wrapper.innerHTML = `<div class="optimaio-offer-card">Loading offers...</div>`;

    let data = await window.getCampaignData();
    const campaigns = Array.isArray(data) ? data : (data?.campaigns || []);

    wrapper.innerHTML = "";

    const active = campaigns.filter(c => c.status === "active");

    active.forEach(campaign => {

      const contentObj = campaign.content || {};
      let contentKeys = Object.keys(contentObj);
      if (!contentKeys.length) return;

      // Sort keys (1st goal, 2nd goal‚Ä¶)
      contentKeys = contentKeys.sort((a, b) => parseInt(a) - parseInt(b));

      contentKeys.forEach((key, i) => {
        const content = contentObj[key];
        const title = content?.offerTitle;
        const subtitle = content?.offerSubtitle;
        if (!title && !subtitle) return;

        const goal = campaign.goals?.[i];

        // ICONS
        let icon = "";
        if (goal?.type === "free_shipping") icon = "üöö";
        else if (goal?.type === "order_discount") icon = "üè∑Ô∏è";
        else if (goal?.type === "free_product") icon = "üéÅ";
        else icon = "‚ú®";

        const card = document.createElement("div");
        card.className = "optimaio-offer-card";

        let html = `
          <div class="optimaio-offer-left">
            <span class="optimaio-offer-icon">${icon}</span>
          </div>

          <div class="optimaio-offer-right">
            <h4 class="optimaio-offer-title">${title}</h4>
            ${subtitle ? `<p class="optimaio-offer-subtitle">${subtitle}</p>` : ""}
          </div>
        `;

        // Free product preview only for free-product goal
        if (goal?.type === "free_product" && goal.products?.length) {
          const p = goal.products[0];
          html += `
            <div class="optimaio-offer-products">
              <div class="optimaio-offer-product">
                <img src="${p.image?.url}" />
                <span>${p.productTitle}</span>
              </div>
            </div>
          `;
        }

        card.innerHTML = html;
        wrapper.appendChild(card);
      });
    });

    if (!wrapper.children.length) {
      wrapper.innerHTML = `<div class="optimaio-offer-card">No offers available</div>`;
    }
  }

  document.addEventListener("DOMContentLoaded", loadOffers);

})();
</script>
